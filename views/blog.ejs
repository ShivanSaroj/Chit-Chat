<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <%- include('./partials/head') %>
    <title><%= blog.title %></title>
    <style>
        /* Your existing styles remain the same */
        .profile-placeholder {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.25rem;
        }
        .comment-profile-placeholder {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1rem;
        }
        pre {
            font-family: var(--bs-font-sans-serif);
            white-space: pre-wrap;
            background-color: var(--bs-body-bg);
            padding: 1rem;
            border-radius: 0.25rem;
            border: 1px solid var(--bs-border-color);
        }
        .author-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="bg-body-secondary">
    <%- include('./partials/nav') %>
   
    <main class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Blog Post Card -->
                <div class="card mb-4 shadow-sm">
                    <% if (blog.coverImageURL) { %>
                        <img src="<%= blog.coverImageURL %>" class="card-img-top img-fluid" alt="Cover image" style="max-height: 400px; object-fit: cover;">
                    <% } %>
                    <div class="card-body">
                        <h1 class="card-title display-5"><%= blog.title %></h1>
                        <div class="author-info">
                            <% if (blog.createdBy && blog.createdBy.profileImageURL) { %>
                                <img src="<%= blog.createdBy.profileImageURL %>" width="50" height="50" class="rounded-circle me-2" alt="Author">
                            <% } else { %>
                                <div class="profile-placeholder me-2">
                                    <%= blog.createdBy && blog.createdBy.fullname ? blog.createdBy.fullname.charAt(0).toUpperCase() : '?' %>
                                </div>
                            <% } %>
                            <div>
                                <p class="mb-0 fw-bold"><%= blog.createdBy ? blog.createdBy.fullname : 'Unknown Author' %></p>
                                <small class="text-muted"><%= new Date(blog.createdAt).toLocaleDateString() %></small>
                            </div>
                        </div>
                        <div class="card-text">
                            <pre><%= blog.body %></pre>
                        </div>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h3 class="mb-0">Comments (<%= comments.length %>)</h3>
                    </div>
                    <div class="card-body">
                        <% if (locals.user) { %>
                        <!-- Comment Form -->
                        <form action="/blog/comment/<%= blog._id %>" method="post" class="mb-4">
                            <div class="input-group">
                                <input type="text" name="content" class="form-control" placeholder="Enter your comment..." required>
                                <button type="submit" class="btn btn-primary">Post</button>
                            </div>
                        </form>
                        <% } %>

                        <!-- Comments List -->
                        <div class="mt-3">
                            <% comments.forEach(comment => { %>
                            <div class="d-flex mb-3">
                                <% if (comment.createdBy && comment.createdBy.profileImageURL) { %>
                                    <img src="<%= comment.createdBy.profileImageURL %>" width="50" height="50" class="rounded-circle me-3" alt="Commenter">
                                <% } else { %>
                                    <div class="comment-profile-placeholder me-3">
                                        <%= comment.createdBy && comment.createdBy.fullname ? comment.createdBy.fullname.charAt(0).toUpperCase() : '?' %>
                                    </div>
                                <% } %>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <h6 class="mb-0 fw-bold"><%= comment.createdBy ? comment.createdBy.fullname : 'Unknown User' %></h6>
                                        <small class="text-muted"><%= new Date(comment.createdAt).toLocaleString() %></small>
                                    </div>
                                    <div class="bg-body p-3 rounded">
                                        <p class="mb-0"><%= comment.content %></p>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                            
                            <% if (comments.length === 0) { %>
                            <div class="text-center py-4">
                                <p class="text-muted">No comments yet. Be the first to comment!</p>
                            </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <%- include('./partials/script') %>
</body>
</html>